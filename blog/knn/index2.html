<!doctypehtml><html lang="jp"><meta charset="utf-8"><title>K近傍法をスクラッチ実装してみる - KBSIs&#39; Blog</title><meta name="viewport"content="width=device-width,initial-scale=1"><link rel="apple-touch-icon"sizes="180x180"href="/img/favicon/apple-touch-icon.png"><link rel="icon"type="image/png"sizes="32x32"href="/img/favicon/favicon-32x32.png"><link rel="icon"type="image/png"sizes="16x16"href="/img/favicon/favicon-16x16.png"><link rel="manifest"href="/img/favicon/site.webmanifest"><link rel="mask-icon"href="/img/favicon/safari-pinned-tab.svg"color="#ffffff"><link rel="shortcut icon"href="/img/favicon/favicon.ico"><meta name="msapplication-config"content="/img/favicon/browserconfig.xml"><meta name="msapplication-TileColor"content="#ffffff"><meta name="theme-color"content="#ffffff"><meta name="generator"content="Hugo 0.77.0"><meta itemprop="name"content="K近傍法をスクラッチ実装してみる"><meta itemprop="description"content="K近傍法をスクラッチ実装する（numpyを用いて）"><meta itemprop="datePublished"content="2020-12-15T15:16:05+09:00"><meta itemprop="dateModified"content="2020-12-15T15:16:05+09:00"><meta itemprop="wordCount"content="97"><meta itemprop="keywords"content="アルゴリズム,データサイエンス,"><meta property="og:title"content="K近傍法をスクラッチ実装してみる"><meta property="og:description"content="K近傍法をスクラッチ実装する（numpyを用いて）"><meta property="og:type"content="article"><meta property="og:url"content="https://idichi.tk/blog/knn/"><meta property="article:published_time"content="2020-12-15T15:16:05+09:00"><meta property="article:modified_time"content="2020-12-15T15:16:05+09:00"><meta property="og:site_name"content="KBSIs&#39; Blog"><meta name="twitter:card"content="summary"><meta name="twitter:title"content="K近傍法をスクラッチ実装してみる"><meta name="twitter:description"content="K近傍法をスクラッチ実装する（numpyを用いて）"><meta name="twitter:site"content="@def___init___"><script data-ad-client="ca-pub-2301758554597016"async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><link rel="stylesheet"href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.16.2/build/styles/default.min.css"><script type="text/x-mathjax-config">MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
    });</script><script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script><link rel="stylesheet"href="/css/normalize.css"><link rel="stylesheet"href="https://fonts.googleapis.com/css?family=Raleway:400,800,900|Source+Sans+Pro:400,700"><link rel="stylesheet"href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css"><link rel="stylesheet"href="https://use.fontawesome.com/releases/v5.9.0/css/all.css"integrity="sha384-i1LQnF23gykqWXg6jxC2ZbCbUMxyw5gLZY6UiUS98LYV5unm8GWmfkIS6jqJfb4E"crossorigin="anonymous"><link rel="stylesheet"href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.3.5/jquery.fancybox.min.css"><link rel="stylesheet"href="/css/main.min.6d22afd25890242552a63002032532e43f59b91eea454409de37a6bc3cc90b90.css"integrity="sha256-bSKv0liQJCVSpjACAyUy5D9ZuR7qRUQJ3jemvDzJC5A="><link rel="stylesheet"href="/css/add-on.css"><header id="site-header"><nav id="site-nav"><h1 class="nav-title"><a href="/">Blog</a></h1><menu id="site-nav-menu"class="flyout-menu"><a href="/"class="link"><i class="fa fa-home"></i> Home</a> <a href="/about/"class="link"><i class="far fa-id-card"></i> About Me</a> <a href="/blog/"class="link"><i class="far fa-newspaper"></i> Blog</a> <a href="/categories/"class="link"><i class="fas fa-sitemap"></i> Categories</a> <a href="#share-menu"class="share-toggle"><i class="fas fa-share-alt">&nbsp;</i>Share</a></menu><a href="#share-menu"class="share-toggle"><i class="fas fa-share-alt fa-2x">&nbsp;</i></a> <a href="#lang-menu"class="lang-toggle"lang="jp">jp</a> <a href="#site-nav"class="nav-toggle"><i class="fas fa-bars fa-2x"></i></a></nav><menu id="lang-menu"class="flyout-menu"><a href="#"lang="jp"class="link active">Japanese (jp)</a> <a href="/en"lang="en"class="no-lang link">English (en)</a></menu><menu id="share-menu"class="flyout-menu"><h1>Share Post</h1><a href="//twitter.com/share?text=K%e8%bf%91%e5%82%8d%e6%b3%95%e3%82%92%e3%82%b9%e3%82%af%e3%83%a9%e3%83%83%e3%83%81%e5%ae%9f%e8%a3%85%e3%81%97%e3%81%a6%e3%81%bf%e3%82%8b&amp;url=https%3a%2f%2fidichi.tk%2fblog%2fknn%2f"target="_blank"rel="noopener"class="share-btn twitter"><i class="fab fa-twitter"></i><p>&nbsp;Twitter</p></a><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fidichi.tk%2fblog%2fknn%2f"target="_blank"rel="noopener"class="share-btn facebook"><i class="fab fa-facebook"></i><p>&nbsp;Facebook</p></a><a href="mailto:?subject=Check out this post by IDICHI&amp;body=https%3a%2f%2fidichi.tk%2fblog%2fknn%2f"target="_blank"class="share-btn email"data-proofer-ignore><i class="fas fa-envelope"></i><p>&nbsp;Email</p></a><a href="//social-plugins.line.me/lineit/share?url=https%3a%2f%2fidichi.tk%2fblog%2fknn%2f"target="_blank"class="share-btn line"data-proofer-ignore style="margin:0;padding:0"><i class="fab fa-line"style="color:green;font-size:2em;padding:0"></i><p>&nbsp;LINE</p></a></menu></header><div id="wrapper"><section id="site-intro"><a href="/"><img src="/img/main/edi-logo.png"class=""width=""alt="KBSI&#39;s Blog!!!"></a><header><h1>KBSIs' Blog</h1></header><main><p>Technical memo, play diary</main><footer><ul class="socnet-icons"><li><a href="//github.com/STU-Idichi-Syoya"target="_blank"rel="noopener"title="GitHub"class="fab fa-github"></a><li><a href="//twitter.com/def___init___"target="_blank"rel="noopener"title="Twitter"class="fab fa-twitter"></a><li><a href="mailto:idichi.syoya@gmail.com"target="_blank"title="Email"class="far fa-envelope"></a></ul></footer></section><main id="site-main"><article class="post"><header><div class="title"><h2><a href="/blog/knn/">K近傍法をスクラッチ実装してみる</a></h2><p>K近傍法をスクラッチ実装する（numpyを用いて）</div><div class="meta"><time class="published"datetime="2020-12-15 15:16:05 &#43;0900 JST">2020-12-15 </time><span class="author">IDICHI</span></div></header><section id="socnet-share"><a href="//twitter.com/share?text=K%e8%bf%91%e5%82%8d%e6%b3%95%e3%82%92%e3%82%b9%e3%82%af%e3%83%a9%e3%83%83%e3%83%81%e5%ae%9f%e8%a3%85%e3%81%97%e3%81%a6%e3%81%bf%e3%82%8b&amp;url=https%3a%2f%2fidichi.tk%2fblog%2fknn%2f"target="_blank"rel="noopener"class="share-btn twitter"><i class="fab fa-twitter"></i><p>&nbsp;Twitter</p></a><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fidichi.tk%2fblog%2fknn%2f"target="_blank"rel="noopener"class="share-btn facebook"><i class="fab fa-facebook"></i><p>&nbsp;Facebook</p></a><a href="mailto:?subject=Check out this post by IDICHI&amp;body=https%3a%2f%2fidichi.tk%2fblog%2fknn%2f"target="_blank"class="share-btn email"data-proofer-ignore><i class="fas fa-envelope"></i><p>&nbsp;Email</p></a><a href="//social-plugins.line.me/lineit/share?url=https%3a%2f%2fidichi.tk%2fblog%2fknn%2f"target="_blank"class="share-btn line"data-proofer-ignore style="margin:0;padding:0"><i class="fab fa-line"style="color:green;font-size:2em;padding:0"></i><p>&nbsp;LINE</p></a></section><div class="content"><h1 id="k近傍法とはなにか">k近傍法とはなにか</h1><p>クラス分類の機械学習の一種のアルゴリズムのこと．<br>k近傍法は学習させるデータ（クラス属性含めて）一つ一つに対して入力データとの類似度（距離）を求め，類似度が高いデータのクラスを入力データのクラスとする．<br>手順は<ol><li>すべてのデータに対して類似度を求め，高いものから順にk個データを選ぶ．<li>それらのデータのクラスを多数決で決定し，そのクラスとする．</ol><p>なお，距離はユークリッド距離でもよいし，マハラノビス距離でもよい（らしい）<br>kの値は，線形探索や，交差検証などによって，決定する．（ハイパラメータなので）<h1 id="スクラッチ実装">スクラッチ実装</h1><p>上記手順を見ればまったく難しくなさそうなので，簡単に実装してみる．<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python"data-lang="Python"><span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
<span style="color:#75715e">## データとクラス（属性）の構造体替わり</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Data</span>:
    <span style="color:#66d9ef">def</span> __init__(self,vec:np<span style="color:#f92672">.</span>array,spector:str) <span style="color:#f92672">-&gt;</span> None:
        self<span style="color:#f92672">.</span>vec<span style="color:#f92672">=</span>vec
        self<span style="color:#f92672">.</span>spec<span style="color:#f92672">=</span>spector

<span style="color:#75715e">## 学習データ</span>
A<span style="color:#f92672">=</span>np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">100</span>,(<span style="color:#ae81ff">10</span>))
B<span style="color:#f92672">=</span>np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">100</span>,(<span style="color:#ae81ff">10</span>))
C<span style="color:#f92672">=</span>np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">100</span>,(<span style="color:#ae81ff">10</span>))
D<span style="color:#f92672">=</span>np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">100</span>,(<span style="color:#ae81ff">10</span>))
E<span style="color:#f92672">=</span>np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">100</span>,(<span style="color:#ae81ff">10</span>))

VectorsArray<span style="color:#f92672">=</span>[Data(A,<span style="color:#e6db74">&#39;A&#39;</span>),Data(B,<span style="color:#e6db74">&#39;B&#39;</span>),Data(C,<span style="color:#e6db74">&#39;A&#39;</span>),Data(D,<span style="color:#e6db74">&#39;B&#39;</span>),Data(E,<span style="color:#e6db74">&#39;A&#39;</span>)]

<span style="color:#75715e">## 類似度（ユークリッド距離）を求める関数</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">getDistance</span>(vec:np<span style="color:#f92672">.</span>array,vec2:np<span style="color:#f92672">.</span>array):
    r<span style="color:#f92672">=</span>np<span style="color:#f92672">.</span>linalg<span style="color:#f92672">.</span>norm(vec<span style="color:#f92672">-</span>vec2,ord<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
    <span style="color:#66d9ef">return</span> r


<span style="color:#e6db74">&#39;&#39;&#39;
</span><span style="color:#e6db74">- K近傍法メインルーチン
</span><span style="color:#e6db74">引数
</span><span style="color:#e6db74">vec:入力データ(np.array)
</span><span style="color:#e6db74">VectorsArray:Data構造体のリスト
</span><span style="color:#e6db74">k : 整数
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">返却値
</span><span style="color:#e6db74">{str(クラス):count(クラスの数)...}
</span><span style="color:#e6db74">利用時は,max関数でkeyを指定する．
</span><span style="color:#e6db74">詳細は__main__()で
</span><span style="color:#e6db74">&#39;&#39;&#39;</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">getNearVecSpec</span>(vec:np<span style="color:#f92672">.</span>array,VectorsArray<span style="color:#f92672">=</span>VectorsArray,k<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>)  :
    distance<span style="color:#f92672">=</span>[]
    <span style="color:#66d9ef">for</span> v <span style="color:#f92672">in</span> VectorsArray:
        d<span style="color:#f92672">=</span>getDistance(vec,v<span style="color:#f92672">.</span>vec)
        distance<span style="color:#f92672">.</span>append((v<span style="color:#f92672">.</span>spec,d))
    distance<span style="color:#f92672">.</span>sort(key<span style="color:#f92672">=</span><span style="color:#66d9ef">lambda</span> X: X[<span style="color:#ae81ff">1</span>])
    <span style="color:#66d9ef">print</span>(distance)
    diss<span style="color:#f92672">=</span>{}
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(k):
        v<span style="color:#f92672">=</span>distance[i]
        spec<span style="color:#f92672">=</span>v[<span style="color:#ae81ff">0</span>]
        <span style="color:#66d9ef">if</span> spec <span style="color:#f92672">in</span> diss:
            diss[spec]<span style="color:#f92672">+=</span><span style="color:#ae81ff">1</span>
        <span style="color:#66d9ef">else</span>:
            diss[spec]<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
    
    <span style="color:#66d9ef">return</span> diss
<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
    a<span style="color:#f92672">=</span>np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>randint(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">100</span>,size<span style="color:#f92672">=</span>(<span style="color:#ae81ff">10</span>))
    d<span style="color:#f92672">=</span>getNearVecSpec(a)
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;予測されたクラス:&#34;</span>,max(d,key<span style="color:#f92672">=</span>d<span style="color:#f92672">.</span>get))
</code></pre></div><p>愚直に実装するとこういう感じになるが，<br>Numpyのブロードキャストを使えば簡潔で高速動作可能なプログラムになるだろう．<h1 id="スクラッチ実装とsklearn実装との比較">スクラッチ実装とsklearn実装との比較</h1><p>sklearnはPythonの機械学習ライブラリで，非常に有名である．<br>今回はそれのk近傍法とスクラッチ実装を比較してみる．<br>実用性があるか確認するため，比較にはirisデータセットを用いる</p><script src="https://gist.github.com/STU-Idichi-Syoya/ae265e43b25726b5af118cb9e5425322.js"></script><p>同じ結果になることを確認した．</div><footer><ul class="stats"><li class="categories"><ul><li><a class="article-category-link"href="https://idichi.tk/categories/%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0">アルゴリズム</a><li><a class="article-category-link"href="https://idichi.tk/categories/%E3%83%87%E3%83%BC%E3%82%BF%E3%82%B5%E3%82%A4%E3%82%A8%E3%83%B3%E3%82%B9">データサイエンス</a><li><a class="article-category-link"href="https://idichi.tk/categories/sk-learn">sk-learn</a></ul><li class="tags"><ul><li><a class="article-category-link"href="https://idichi.tk/tags/%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0">アルゴリズム</a><li><a class="article-category-link"href="https://idichi.tk/tags/%E3%83%87%E3%83%BC%E3%82%BF%E3%82%B5%E3%82%A4%E3%82%A8%E3%83%B3%E3%82%B9">データサイエンス</a></ul></ul></footer></article><div id="disqus_thread"></div><script>!function(){var t=document,e=t.createElement("script");e.src="https://kbsis-blog.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><script id="dsq-count-scr"src="//kbsis-blog.disqus.com/count.js"async></script><div class="pagination"><a href="/blog/ccc-winner/"class="button"><div class="previous"><div>企業賞とオーディエンス賞GETした</div></div></a><a href="/blog/servay-arcface/"class="button"><div class="next"><div>【調査中】ArcFaceなどのメトリックラーニング</div></div></a></div></main><section id="site-sidebar"><section id="recent-posts"><header><h1>Recent posts</h1></header><article class="mini-post"><section></section><header><h1><a href="/blog/servay-arcface/">【調査中】ArcFaceなどのメトリックラーニング</a></h1><time class="published"datetime="">2020-12-17</time></header></article><article class="mini-post"><section></section><header><h1><a href="/blog/knn/">K近傍法をスクラッチ実装してみる</a></h1><time class="published"datetime="">2020-12-15</time></header></article><article class="mini-post"><section></section><header><h1><a href="/blog/ccc-winner/">企業賞とオーディエンス賞GETした</a></h1><time class="published"datetime="">2020-10-25</time></header></article><article class="mini-post"><section><a href="/blog/losemicrosoft/"class="image featured"><img src="/"alt=""></a></section><header><h1><a href="/blog/losemicrosoft/">&lt;AI開発 part2&gt;転移学習によるCNNの学習</a></h1><time class="published"datetime="">2020-05-31</time></header></article><article class="mini-post"><section><a href="/blog/newcircle/"class="image featured"><img src="/"alt=""></a></section><header><h1><a href="/blog/newcircle/">サークルを作った話。</a></h1><time class="published"datetime="">2020-05-31</time></header></article><a href="/blog/"class="button">See more</a></section><section id="categories"><header><h1><a href="/categories">Categories</a></h1></header><ul><li><a href="/categories/ai/">ai<span class="count">1</span></a><li><a href="/categories/ai%E9%96%8B%E7%99%BA/">ai開発<span class="count">2</span></a><li><a href="/categories/blog/">blog<span class="count">2</span></a><li><a href="/categories/github/">github<span class="count">1</span></a><li><a href="/categories/jetson-nano/">jetson-nano<span class="count">1</span></a><li><a href="/categories/jphacks/">jphacks<span class="count">1</span></a><li><a href="/categories/mxnet/">mxnet<span class="count">1</span></a><li><a href="/categories/python/">python<span class="count">1</span></a><li><a href="/categories/server/">server<span class="count">1</span></a><li><a href="/categories/sk-learn/">sk-learn<span class="count">1</span></a><li><a href="/categories/tensorflow/">tensorflow<span class="count">2</span></a><li><a href="/categories/%E3%82%A2%E3%83%AB%E3%82%B4%E3%83%AA%E3%82%BA%E3%83%A0/">アルゴリズム<span class="count">1</span></a><li><a href="/categories/%E3%82%B5%E3%83%BC%E3%82%AF%E3%83%AB/">サークル<span class="count">1</span></a><li><a href="/categories/%E3%82%B9%E3%82%AF%E3%83%AC%E3%82%A4%E3%83%94%E3%83%B3%E3%82%B0/">スクレイピング<span class="count">1</span></a><li><a href="/categories/%E3%83%87%E3%82%A3%E3%83%BC%E3%83%97%E3%83%A9%E3%83%BC%E3%83%8B%E3%83%B3%E3%82%B0/">ディープラーニング<span class="count">6</span></a><li><a href="/categories/%E3%83%87%E3%83%BC%E3%82%BF%E3%82%B5%E3%82%A4%E3%82%A8%E3%83%B3%E3%82%B9/">データサイエンス<span class="count">1</span></a><li><a href="/categories/%E3%83%8F%E3%83%83%E3%82%AB%E3%82%BD%E3%83%B3/">ハッカソン<span class="count">2</span></a><li><a href="/categories/%E5%8B%95%E7%94%BB/">動画<span class="count">1</span></a><li><a href="/categories/%E5%A4%B1%E6%95%97/">失敗<span class="count">1</span></a></ul></section><section id="mini-bio"><header><h1>About</h1></header><p>大学2年生 伊地知 翔也 詳細はlearn moreから<footer><a href="/about"class="button">Learn More</a></footer></section></section><footer id="site-footer"><ul class="socnet-icons"><li><a href="//github.com/STU-Idichi-Syoya"target="_blank"rel="noopener"title="GitHub"class="fab fa-github"></a><li><a href="//twitter.com/def___init___"target="_blank"rel="noopener"title="Twitter"class="fab fa-twitter"></a><li><a href="mailto:idichi.syoya@gmail.com"target="_blank"title="Email"class="far fa-envelope"></a></ul><p class="copyright">&copy; 2020 KBSIs&#39; Blog .<br>IDICHI-SHOYA</footer><a id="back-to-top"href="#"class="fas fa-arrow-up fa-2x"></a><script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.16.2/build/highlight.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.16.2/languages/html.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.16.2/languages/css.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.16.2/languages/js.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.16.2/languages/toml.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.16.2/languages/python.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.16.2/languages/c.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.16.2/languages/bash.min.js"></script><script>hljs.initHighlightingOnLoad()</script><script src="https://code.jquery.com/jquery-3.3.1.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/skel/3.0.1/skel.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.3.5/jquery.fancybox.min.js"></script><script src="/js/util.js"></script><script src="/js/main.js"></script><script src="/js/add-on.js"></script><script>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-138069451-2","auto"),ga("send","pageview"))</script><script async src="https://www.google-analytics.com/analytics.js"></script></div>